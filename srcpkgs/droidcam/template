# Template file for 'droidcam'
pkgname=droidcam
version=1.7.1
revision=1
make_build_args="USBMUXD=-lusbmuxd-2.0"
makedepends="pkg-config libjpeg-turbo-devel ffmpeg-devel alsa-lib-devel \
			 speex-devel libusbmuxd-devel libplist-devel gtk+3-devel"
depends="v4l2loopback"
short_desc="Tool for using your android device as a wireless/usb webcam"
maintainer="ibrokemypie <ibrokemypie@bastardi.net>"
license="GPL-2.0-or-later"
homepage="https://github.com/dev47apps/droidcam"
distfiles="https://github.com/dev47apps/droidcam/archive/v${version}.tar.gz"
checksum="1f925c093df165afcd39e76b12a3db0f19fabbf15a11e1c7b55a97bba331f113"
nopie=true
#build_style="gnu-makefile"

pre_build() {
	make_build_args="${make_build_args} \
		JPEG=$(pkg-config --libs --cflags libturbojpeg)"
}

do_build() {
	make ${make_build_args}
}

post_build() {
	vsed -e "s/Icon=.*/Icon=droidcam/" -i droidcam.desktop
}

do_install() {
	vbin droidcam
	vbin droidcam-cli
	vinstall icon2.png 644 /usr/share/pixmaps/ droidcam.png
	vinstall icon2.png 644 /opt/ droidcam-icon.png
	vinstall ${FILESDIR}/droidcam.desktop 644 /usr/share/applications/
	vdoc README.md
}
